<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSPR Globe</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Sidebar Toggle Button (for mobile and collapsed state) -->
    <button class="sidebar-toggle" id="sidebarToggle" title="Toggle sidebar">☰</button>

    <!-- Left Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>WSPR Globe</h1>
            <button class="sidebar-close" id="sidebarClose" title="Close sidebar">✕</button>
        </div>

        <!-- How to Use Accordion -->
        <div class="accordion">
            <button class="accordion-header" id="howToUseToggle">
                <span>How to Use</span>
                <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content" id="howToUseContent">
                <div class="how-to-content">
                    <h3>Getting Started</h3>
                    <p>WSPR Globe visualizes WSPR (Weak Signal Propagation Reporter) spots on an interactive 3D globe. Each arc represents a radio propagation path between a transmitter and receiver.</p>
                    
                    <h3>Searching for Spots</h3>
                    <ul>
                        <li><strong>Call Signs:</strong> Enter a receiver or transmitter call sign to filter spots. Leave empty to see all spots.</li>
                        <li><strong>Time Window:</strong> Select how far back in time to search (from 5 minutes to 7 days).</li>
                        <li><strong>Days Ago:</strong> Offset the time window by selecting how many days in the past to search (0-7 days). For example, "Last 15 Minutes" with "1 Day Ago" searches for the same 15-minute window from yesterday.</li>
                        <li><strong>Frequency Bands:</strong> Check/uncheck bands to include or exclude specific frequencies.</li>
                        <li><strong>Load WSPR Spots:</strong> Click the button to fetch and display spots matching your criteria.</li>
                    </ul>
                    
                    <h3>Display Modes</h3>
                    <ul>
                        <li><strong>Arc Mode:</strong> Shows propagation paths as arcs between TX and RX locations. Arcs peak at ~300 km altitude.</li>
                        <li><strong>Beacon Mode:</strong> Tracks a moving transmitter over time, showing its location at each 2-minute interval.</li>
                        <li><strong>Heatmap Mode:</strong> Color-codes regions by contact density (most active areas are brightest).</li>
                    </ul>
                    
                    <h3>Visualization Options</h3>
                    <ul>
                        <li><strong>Animate Lines:</strong> Adds a moving "dot dot dot" pattern along arcs.</li>
                        <li><strong>Solid Lines:</strong> Makes arcs fully opaque (default is semi-transparent).</li>
                        <li><strong>Show TX/RX Markers:</strong> Displays solid circles at transmitters and open circles at receivers.</li>
                        <li><strong>Max Lines:</strong> Limits the number of arcs displayed for better performance.</li>
                    </ul>
                    
                    <h3>Interacting with the Globe</h3>
                    <ul>
                        <li><strong>Rotate:</strong> Click and drag to rotate the globe.</li>
                        <li><strong>Zoom:</strong> Scroll to zoom in/out.</li>
                        <li><strong>Details:</strong> Click on any arc or point to see spot details (callsigns, distance, frequency, SNR, power, time).</li>
                    </ul>
                    
                    <h3>Statistics Panel</h3>
                    <p>After loading spots, view statistics including total spots, unique paths, furthest contact distance, most active band, and SNR metrics.</p>
                </div>
            </div>
        </div>

        <h2>Call Sign Filters</h2>
        <div class="form-group">
            <label for="rxCallsign">Receiver Call Sign</label>
            <input type="text" id="rxCallsign" placeholder="K6AUS" style="text-transform: uppercase;">
            <div class="help-text">Leave empty for all receivers</div>
        </div>

        <div class="form-group">
            <label for="txCallsign">Transmitter Call Sign</label>
            <input type="text" id="txCallsign" placeholder="K6AUS" style="text-transform: uppercase;">
            <div class="help-text">Leave empty for all transmitters</div>
        </div>

        <h2>Time Range</h2>
        <div class="form-group">
            <label for="timeWindow">Time Window</label>
            <select id="timeWindow">
                <option value="5">Last 5 Minutes</option>
                <option value="15" selected>Last 15 Minutes</option>
                <option value="30">Last 30 Minutes</option>
                <option value="60">Last 1 Hour</option>
                <option value="240">Last 4 Hours</option>
                <option value="480">Last 8 Hours</option>
                <option value="720">Last 12 Hours</option>
                <option value="1440">Last 24 Hours</option>
                <option value="4320">Last 3 Days</option>
                <option value="10080">Last 7 Days</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="daysAgo">Days Ago</label>
            <select id="daysAgo">
                <option value="0" selected>Today</option>
                <option value="1">1 Day Ago</option>
                <option value="2">2 Days Ago</option>
                <option value="3">3 Days Ago</option>
                <option value="4">4 Days Ago</option>
                <option value="5">5 Days Ago</option>
                <option value="6">6 Days Ago</option>
                <option value="7">7 Days Ago</option>
            </select>
            <div class="help-text">Offset the time window by this many days</div>
        </div>

        <h2>Display Options</h2>
        <div class="form-group">
            <label for="maxLines">Max Lines to Draw</label>
            <select id="maxLines">
                <option value="100">100 Lines</option>
                <option value="500">500 Lines</option>
                <option value="1000" selected>1,000 Lines</option>
                <option value="5000">5,000 Lines</option>
                <option value="10000">10,000 Lines</option>
                <option value="25000">25,000 Lines</option>
                <option value="50000">50,000 Lines</option>
            </select>
        </div>

        <div class="form-group checkbox-group">
            <label class="checkbox-label">
                <input type="checkbox" id="beaconMode">
                <span>Beacon mode (track TX location)</span>
            </label>
        </div>

        <div id="arcOptions">
            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="animateLines" checked>
                    <span>Animate lines</span>
                </label>
            </div>

            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="solidLines">
                    <span>Solid lines (no transparency)</span>
                </label>
            </div>

            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="showMarkers" checked>
                    <span>Show TX/RX markers</span>
                </label>
            </div>

            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="heatmapMode">
                    <span>Heatmap mode</span>
                </label>
            </div>

        </div>

        <button class="btn btn-primary" id="loadBtn">Load WSPR Spots</button>

        <div class="status" id="status">Ready to search</div>

        <!-- Stats Panel -->
        <div class="stats-panel" id="statsPanel" style="display: none;">
            <h2>Statistics</h2>
            <div class="stat-row">
                <span class="stat-label">Total Spots</span>
                <span class="stat-value" id="statTotalSpots">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Unique Paths</span>
                <span class="stat-value" id="statUniquePaths">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Furthest Contact</span>
                <span class="stat-value" id="statFurthest">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Most Active Band</span>
                <span class="stat-value" id="statActiveBand">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Avg SNR</span>
                <span class="stat-value" id="statAvgSNR">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Best SNR</span>
                <span class="stat-value" id="statBestSNR">-</span>
            </div>
        </div>

        <div class="band-legend" id="frequencyLegend">
            <h2>Frequency Bands <button class="btn-small" id="selectAllBands">All</button> <button class="btn-small" id="selectNoBands">None</button></h2>
            <div class="band-filter">
                <label class="band-checkbox"><input type="checkbox" data-band="0.137" checked><span class="band-color" style="background: #ff0000;"></span>137 kHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="0.475" checked><span class="band-color" style="background: #ff6600;"></span>475 kHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="1.8" checked><span class="band-color" style="background: #ffcc00;"></span>1.8 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="3.5" checked><span class="band-color" style="background: #99ff00;"></span>3.5 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="7" checked><span class="band-color" style="background: #00ff00;"></span>7 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="10" checked><span class="band-color" style="background: #00ff99;"></span>10 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="14" checked><span class="band-color" style="background: #00ffff;"></span>14 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="18" checked><span class="band-color" style="background: #0099ff;"></span>18 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="21" checked><span class="band-color" style="background: #0000ff;"></span>21 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="28" checked><span class="band-color" style="background: #9900ff;"></span>28 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="50" checked><span class="band-color" style="background: #ff00ff;"></span>50 MHz</label>
                <label class="band-checkbox"><input type="checkbox" data-band="144" checked><span class="band-color" style="background: #ff0099;"></span>144 MHz</label>
            </div>
        </div>

        <div class="band-legend" id="beaconLegend" style="display: none;">
            <h2>Beacon Time Gradient</h2>
            <div class="time-gradient">
                <div class="gradient-bar"></div>
                <div class="gradient-labels">
                    <span>Oldest</span>
                    <span>Newest</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Globe Container -->
    <div id="globeContainer">
        <div class="globe-info">Drag to rotate • Scroll to zoom • Click arc for details</div>
    </div>

    <!-- Spot Details Popup -->
    <div class="spot-popup" id="spotPopup">
        <button class="popup-close" id="popupClose">✕</button>
        <div class="popup-content" id="popupContent"></div>
    </div>

    <script src="https://unpkg.com/globe.gl"></script>
    <script src="app.js"></script>
</body>
</html>
